# Mafia Assistant

Веб-сервис и Telegram-бот, которые помогают ведущему управлять партией в «Мафию»: вести список игроков, роли, фазы, фиксировать результат и смотреть статистику.

> Проект разработан в рамках преддипломной практики.<br>
> Автор: Казарина Алёна Алексеевна<br>
> Начало разработки: 10.11.2025<br>
> Конец разработки: 07.12.2025<br>
> Ссылка на веб-ресурс: https://mafia-assistant.onrender.com/<br>
> Ссылка на телеграм-бот: @MafiaAssistantPDP_bot


## Основные возможности

- управление игровыми сессиями и режимами (классика / спортивная мафия);
- роли с описаниями и порядком хода;
- кабинет ведущего и кабинет игрока;
- Telegram-бот для управления партией.

## Технологии

- Python 3.13.3;
- Django 6.0;
- SQLite (по умолчанию);
- `python-telegram-bot` *Version: 21.7* для Telegram-бота;
- HTML + CSS.

## Установка и запуск (локально)

```bash
git clone git@github.com:alenkaz07/mafia-assistant.git
cd mafia-assistant
```

В корне проекта создайте директорию `.env`. И добавьте переменную `SECRET_KEY`

```env
SECRET_KEY=ваш_секретный_ключ
```

Далее:
```bash
python -m venv venv
source venv/bin/activate
# Windows: venv\Scripts\activate

pip install -r requirements.txt

python manage.py migrate
# python manage.py createsuperuser # можно пропустить, т.к. в базе есть админ

python manage.py runserver
```

Приложение будет доступно по адресу http://localhost:8000/

## Telegram-бот

1. Создайте бота через `@BotFather` и получите токен.

2. Добавьте переменную `TG_BOT_TOKEN` в `.env`

```env
TG_BOT_TOKEN=ваш_токен
```

3. Запустите бота:

```bash
python manage.py runbot
```

> Бот работает параллельно с сайтом и пишет данные в те же модели (Session, Player, Result и др.).

### Основные команды бота в чате:

- `/start` — краткая инструкция по работе бота.
- `/help` — полный список команд.
- `/startgame N [classic|sport]` — создать новую игру на N игроков.
  Примеры: `/startgame 10`, `/startgame 10 classic`.
- `/addplayer` — включить режим добавления игроков (дальше отправлять имена списком или по одному).
- `/players` — показать текущий список игроков.
- `/assign random` — бот сам раздаёт роли.
- `/assign cards` — роли раздаются офлайн по карточкам (бот их не знает).
- `/next` — переход между фазами (Ночь → День → Голосование → следующая Ночь).

Ночь:

- `/check [Имя]` — проверка комиссаром.
- `/kill [Имя]` — выбор жертвы мафии.
- `/heal [Имя]` — выбор, кого лечит доктор (в классическом режиме).

Голосование:

- `/lynch [Имя]` — исключить игрока по итогам голосования.

Сброс:

- `/reset` — сброс текущей партии в этом чате (сессия помечается как отменённая).

## Структура проекта
- `game/models.py` — режимы, роли, фазы, сессии, игроки, голосования, результаты.
- `game/views.py` — страницы сайта.
- `game/templates/game/` — шаблоны (главная, роли, режимы, сессии, карта сайта, 404 и др.).
- `game/management/commands/runbot.py` — код Telegram-бота.
- `static/game/` — стили и скрипты фронтенда.
