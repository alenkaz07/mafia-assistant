{% extends 'game/base.html' %}

{% block breadcrumbs %}
<nav class="breadcrumbs">
    <a href="{% url 'game:index' %}" class="crumb">Главная</a>
    <span class="crumb-sep">/</span>
    <span class="crumb crumb-active">Кабинет ведущего</span>
</nav>
{% endblock %}

{% block content %}
<h1 class="page-title">Панель ведущего</h1>
<p class="page-subtitle">
    Управление игровыми сессиями веб-сервиса «Мафия-ассистент».
</p>

<section class="sessions-panel">
    <table class="sessions-table">
        <thead>
            <tr>
                <th data-sort-type="number">ID</th>
                <th data-sort-type="text">Режим</th>
                <th data-sort-type="text">Статус</th>
                <th data-sort-type="number">Игроков</th>
                <th data-sort-type="text">Создана</th>
                <th class="sessions-table-actions-col">Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for s in sessions %}
                <tr>
                    <td>{{ s.id }}</td>
                    <td>{{ s.mode.name }}</td>
                    <td>{{ s.get_status_display }}</td>
                    <td>{{ s.players_count }}</td>
                    <td>{{ s.created_at|date:"d.m.Y H:i" }}</td>
                    <td class="sessions-table-actions-col">
                        <a href="{% url 'game:session_manage' s.id %}"
                           class="btn-secondary btn-small">
                            Открыть
                        </a>
                        <!-- Удалить сессию -->
                        <form method="post"
                              action="{% url 'game:session_delete' s.id %}"
                              style="display:inline-block; margin-left: 8px;"
                              onsubmit="return confirm('Удалить сессию #{{ s.id }} со всеми игроками и результатами?');">
                            {% csrf_token %}
                            <!-- Куда вернуться после удаления -->
                            <input type="hidden" name="next" value="{% url 'game:host_sessions' %}">
                            <button type="submit" class="btn-secondary btn-small">
                                Удалить
                            </button>
                        </form>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6">Сессий пока нет.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<div class="host-actions host-actions-bottom">
    <a href="{% url 'game:session_create' %}" class="btn-primary">
        Создать новую сессию
    </a>
</div>
{% endblock %}
